<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Products - FleetFlow Admin</title>
    <style>
        /* Your existing CSS styles remain exactly the same */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Poppins", sans-serif;
            background: #f9f9f9;
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 240px;
            background: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 600;
            color: #ff7b00;
            margin-bottom: 40px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: #ff7b00;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            padding: 12px 16px;
            margin-bottom: 4px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #666;
            font-size: 15px;
            text-decoration: none;
        }

        .nav-item:hover {
            background: #f0f0f0;
        }

        .nav-item.active {
            background: #fff5eb;
            color: #ff7b00;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
        }

        .footer-text {
            margin-top: auto;
            font-size: 12px;
            color: #999;
            padding: 16px;
        }

        .main-content {
            flex: 1;
            padding: 30px 40px;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .top-bar-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .top-bar-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-welcome {
            color: #666;
            font-size: 14px;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff7b00 0%, #e56c00 100%);
            position: relative;
        }

        .user-avatar::after {
            content: '';
            width: 10px;
            height: 10px;
            background: #22c55e;
            border: 2px solid white;
            border-radius: 50%;
            position: absolute;
            bottom: 0;
            right: 0;
        }

        .logout-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #f9f9f9;
            transform: scale(1.05);
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 32px;
            color: #222;
        }

        .add-vehicle-btn {
            padding: 12px 24px;
            background: #ff7b00;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .add-vehicle-btn:hover {
            background: #e56c00;
            transform: scale(1.05);
        }

        .content-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            color: #222;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .search-box {
            position: relative;
            width: 250px;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            width: 18px;
            height: 18px;
        }

        .search-input {
            width: 100%;
            padding: 10px 12px 10px 40px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            transition: border 0.2s;
        }

        .search-input:focus {
            border-color: #ff7b00;
        }

        .filter-btn {
            padding: 10px 16px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            background: #f9f9f9;
        }

        .vehicle-table {
            width: 100%;
            border-collapse: collapse;
        }

        .vehicle-table thead {
            border-bottom: 2px solid #f0f0f0;
        }

        .vehicle-table th {
            text-align: left;
            padding: 16px;
            font-size: 14px;
            font-weight: 600;
            color: #666;
        }

        .vehicle-table td {
            padding: 20px 16px;
            border-bottom: 1px solid #f0f0f0;
            color: #333;
            font-size: 15px;
        }

        .vehicle-table tbody tr {
            transition: background 0.2s;
        }

        .vehicle-table tbody tr:hover {
            background: #fafafa;
        }

        .vehicle-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .vehicle-icon {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 500;
        }

        .status-available {
            background: #dcfce7;
            color: #166534;
        }

        .status-rented {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-maintenance {
            background: #fef3c7;
            color: #92400e;
        }

        .actions-cell {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .edit-action {
            background: #f0f0f0;
            color: #333;
        }

        .edit-action:hover {
            background: #e5e5e5;
            transform: scale(1.05);
        }

        .delete-action {
            background: #fee2e2;
            color: #dc2626;
        }

        .delete-action:hover {
            background: #fecaca;
            transform: scale(1.05);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .modal-header {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #222;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            transition: border 0.2s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: #ff7b00;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .cancel-btn, .save-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .cancel-btn {
            background: #f0f0f0;
            color: #333;
        }

        .cancel-btn:hover {
            background: #e5e5e5;
            transform: scale(1.05);
        }

        .save-btn {
            background: #ff7b00;
            color: white;
        }

        .save-btn:hover {
            background: #e56c00;
            transform: scale(1.05);
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            background: #10b981;
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.error {
            background: #ef4444;
        }

        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #ff7b00;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            gap: 10px;
        }

        .pagination button {
            padding: 8px 12px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pagination button:hover:not(:disabled) {
            background: #f0f0f0;
        }

        .pagination button.active {
            background: #ff7b00;
            color: white;
            border-color: #ff7b00;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .error-message {
            background: #fee2e2;
            color: #dc2626;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .success-message {
            background: #dcfce7;
            color: #166534;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <div class="logo-icon">R</div>
            <span>Reliant Rental Admin</span>
        </div>
        
        <ul class="nav-menu">
            <a href="Dashboard.html" class="nav-item">
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                </svg>
                Dashboard
            </a>
            <a href="ManageAdmin.html" class="nav-item">
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                </svg>
                Manage Admins
            </a>
            <a href="ManageVehicles.html" class="nav-item active">
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"/>
                </svg>
                Manage Products
            </a>
            <a href="UserDetails.html" class="nav-item">
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
                Manage Users
            </a>
            <a href="ManagePayment.html" class="nav-item">
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                </svg>
                Manage Payments
            </a>
            <a href="ViewBookings.html" class="nav-item">
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                View Bookings
            </a>
            <a href="SystemSetting.html" class="nav-item">
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                System Settings
            </a>
        </ul>
        
        <div class="footer-text">
            ¬© 2025 Reliant Rental Admin. All rights reserved.
        </div>
    </div>

    <div class="main-content">
        <div class="top-bar">
            <div class="top-bar-left">
                <div class="logo-icon">R</div>
                <span style="font-weight: 600; font-size: 18px; color: #ff7b00;">Reliant Rental Admin</span>
            </div>
            <div class="top-bar-right">
                <span class="user-welcome">Welcome, Admin User</span>
                <div class="user-avatar"></div>
            </div>
        </div>

        <div class="page-header">
            <h1>Manage Products</h1>
            <button class="add-vehicle-btn" onclick="openAddModal()">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Add Vehicle
            </button>
        </div>

        <div class="content-card">
            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>
            
            <div class="card-header">
                <h2 class="card-title">Vehicle Inventory</h2>
                <div class="header-actions">
                    <div class="search-box">
                        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        <input type="text" class="search-input" placeholder="Search vehicles..." id="searchInput">
                    </div>
                    <button class="filter-btn" onclick="toggleFilter()">
                        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
                        </svg>
                        Filter
                    </button>
                </div>
            </div>
            
            <div id="vehicleTableContainer">
                <table class="vehicle-table">
                    <thead>
                        <tr>
                            <th>Vehicle</th>
                            <th>Type</th>
                            <th>Brand/Model</th>
                            <th>Price/Day</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="vehicleTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">
                                <div class="spinner"></div>
                                Loading vehicles...
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div id="noResults" class="no-results" style="display: none;">
                    No vehicles found matching your search criteria.
                </div>
            </div>
            
            <div class="pagination" id="paginationContainer">
                <!-- Pagination will be generated here -->
            </div>
        </div>
    </div>

    <!-- Add/Edit Vehicle Modal -->
    <div class="modal" id="vehicleModal">
        <div class="modal-content">
            <div class="modal-header" id="modalHeader">Add Vehicle</div>
            <form id="vehicleForm">
                <input type="hidden" id="vehicleId">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="vehicleName">Vehicle Name</label>
                        <input type="text" class="form-input" id="vehicleName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="vehicleType">Vehicle Type</label>
                        <select class="form-select" id="vehicleType" required>
                            <option value="">Select Type</option>
                            <option value="city_bike">City Bike</option>
                            <option value="mountain_bike">Mountain Bike</option>
                            <option value="electric_scooter">Electric Scooter</option>
                            <option value="compact_sedan">Compact Sedan</option>
                            <option value="luxury_sedan">Luxury Sedan</option>
                            <option value="mid_size_suv">Mid Size SUV</option>
                            <option value="van">Van</option>
                            <option value="three_wheeler">Three Wheeler</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="vehicleBrand">Brand</label>
                        <input type="text" class="form-input" id="vehicleBrand" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="vehicleModel">Model</label>
                        <input type="text" class="form-input" id="vehicleModel" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="vehicleYear">Year</label>
                        <input type="number" class="form-input" id="vehicleYear" min="2000" max="2025" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="vehiclePrice">Price/Day ($)</label>
                        <input type="number" class="form-input" id="vehiclePrice" min="0" step="0.01" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="vehiclePriceHour">Price/Hour ($)</label>
                        <input type="number" class="form-input" id="vehiclePriceHour" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="vehicleCapacity">Capacity</label>
                        <input type="number" class="form-input" id="vehicleCapacity" min="1" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="vehicleFuelType">Fuel Type</label>
                        <select class="form-select" id="vehicleFuelType">
                            <option value="">Select Fuel Type</option>
                            <option value="Petrol">Petrol</option>
                            <option value="Diesel">Diesel</option>
                            <option value="Electric">Electric</option>
                            <option value="N/A">N/A</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="vehicleTransmission">Transmission</label>
                        <select class="form-select" id="vehicleTransmission">
                            <option value="">Select Transmission</option>
                            <option value="Manual">Manual</option>
                            <option value="Automatic">Automatic</option>
                            <option value="N/A">N/A</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="vehicleLocation">Location</label>
                    <input type="text" class="form-input" id="vehicleLocation" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="vehicleStatus">Status</label>
                    <select class="form-select" id="vehicleStatus" required>
                        <option value="available">Available</option>
                        <option value="rented">Rented</option>
                        <option value="maintenance">Maintenance</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="vehicleFeatures">Features (comma separated)</label>
                    <textarea class="form-textarea" id="vehicleFeatures" placeholder="GPS, Bluetooth, AC, etc."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="cancel-btn" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="save-btn" id="saveBtn">
                        <span class="spinner" id="saveSpinner" style="display: none;"></span>
                        Save Vehicle
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">Confirm Action</div>
            <p id="confirmMessage">Are you sure you want to delete this vehicle?</p>
            <div class="modal-actions">
                <button type="button" class="cancel-btn" onclick="closeConfirmModal()">Cancel</button>
                <button type="button" class="save-btn" id="confirmActionBtn">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">Admin Login</div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label" for="loginEmail">Email</label>
                    <input type="email" class="form-input" id="loginEmail" value="admin@reliantrental.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="loginPassword">Password</label>
                    <input type="password" class="form-input" id="loginPassword" value="admin123" required>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="save-btn">
                        <span class="spinner" id="loginSpinner" style="display: none;"></span>
                        Login
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'http://localhost:5000/api';
        
        // Global state
        let vehicles = [];
        let currentPage = 1;
        const itemsPerPage = 10;
        let filteredVehicles = [];
        let currentVehicleId = null;
        let authToken = localStorage.getItem('adminToken');

        // DOM Elements
        const vehicleTableBody = document.getElementById('vehicleTableBody');
        const vehicleModal = document.getElementById('vehicleModal');
        const confirmModal = document.getElementById('confirmModal');
        const loginModal = document.getElementById('loginModal');
        const vehicleForm = document.getElementById('vehicleForm');
        const loginForm = document.getElementById('loginForm');
        const searchInput = document.getElementById('searchInput');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        const paginationContainer = document.getElementById('paginationContainer');
        const noResults = document.getElementById('noResults');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initializing Manage Products page');
            
            // Check if user is already logged in
            if (authToken) {
                console.log('‚úÖ User already logged in');
                loadVehicles();
            } else {
                console.log('üîê User not logged in, showing login modal');
                showLoginModal();
            }
            
            // Add event listener for search input
            searchInput.addEventListener('input', debounce(handleSearch, 300));
        });

        // Authentication Functions
        async function adminLogin(email, password) {
            try {
                console.log('üîê Attempting admin login');
                
                const response = await fetch(`${API_BASE_URL}/auth/admin-login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });
                
                console.log('üîê Login response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('üîê Login response data:', result);
                
                if (result.success && result.token) {
                    authToken = result.token;
                    localStorage.setItem('adminToken', authToken);
                    console.log('‚úÖ Login successful, token saved');
                    return true;
                } else {
                    throw new Error(result.message || 'Login failed');
                }
            } catch (error) {
                console.error('‚ùå Login error:', error);
                throw error;
            }
        }

        function showLoginModal() {
            loginModal.classList.add('active');
        }

        function hideLoginModal() {
            loginModal.classList.remove('active');
        }

        function logout() {
            authToken = null;
            localStorage.removeItem('adminToken');
            vehicles = [];
            filteredVehicles = [];
            renderVehicles();
            showLoginModal();
            showSuccess('Logged out successfully');
        }

        // API Functions with authentication headers
        async function makeAuthenticatedRequest(url, options = {}) {
            if (!authToken) {
                throw new Error('Authentication required. Please login.');
            }

            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                }
            };

            const mergedOptions = {
                ...defaultOptions,
                ...options,
                headers: {
                    ...defaultOptions.headers,
                    ...options.headers
                }
            };

            const response = await fetch(url, mergedOptions);
            
            if (response.status === 401) {
                // Token expired or invalid
                logout();
                throw new Error('Session expired. Please login again.');
            }
            
            return response;
        }

        async function loadVehicles() {
            try {
                showLoading(true);
                console.log('üîÑ Loading vehicles from API...');
                
                const response = await makeAuthenticatedRequest(`${API_BASE_URL}/vehicles`);
                console.log('üì° API Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('üì¶ API Response data:', result);
                
                if (result.success) {
                    vehicles = result.vehicles || result.data || [];
                    console.log(`‚úÖ Loaded ${vehicles.length} vehicles`);
                    filteredVehicles = [...vehicles];
                    renderVehicles();
                    renderPagination();
                    showSuccess('Vehicles loaded successfully');
                } else {
                    throw new Error(result.message || 'Failed to load vehicles');
                }
            } catch (error) {
                console.error('‚ùå Error loading vehicles:', error);
                showError('Failed to load vehicles: ' + error.message);
                
                if (error.message.includes('Authentication required') || error.message.includes('Session expired')) {
                    showLoginModal();
                }
            } finally {
                showLoading(false);
            }
        }

        async function saveVehicle(vehicleData) {
            try {
                console.log('üíæ Saving vehicle:', vehicleData);
                
                const method = vehicleData.id ? 'PUT' : 'POST';
                const url = vehicleData.id ? `${API_BASE_URL}/vehicles/${vehicleData.id}` : `${API_BASE_URL}/vehicles`;
                
                const response = await makeAuthenticatedRequest(url, {
                    method: method,
                    body: JSON.stringify(vehicleData)
                });
                
                console.log('üíæ Save response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('üíæ Save response data:', result);
                
                if (!result.success) {
                    throw new Error(result.message || 'Failed to save vehicle');
                }
                
                return result.vehicle || result.data;
            } catch (error) {
                console.error('‚ùå Error saving vehicle:', error);
                throw error;
            }
        }

        async function deleteVehicle(id) {
            try {
                console.log('üóëÔ∏è Deleting vehicle ID:', id);
                
                const response = await makeAuthenticatedRequest(`${API_BASE_URL}/vehicles/${id}`, {
                    method: 'DELETE'
                });
                
                console.log('üóëÔ∏è Delete response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('üóëÔ∏è Delete response data:', result);
                
                if (!result.success) {
                    throw new Error(result.message || 'Failed to delete vehicle');
                }
                
                return result;
            } catch (error) {
                console.error('‚ùå Error deleting vehicle:', error);
                throw error;
            }
        }

        async function editVehicle(id) {
            try {
                console.log('‚úèÔ∏è Editing vehicle ID:', id);
                const response = await makeAuthenticatedRequest(`${API_BASE_URL}/vehicles/${id}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    const vehicle = result.vehicle || result.data;
                    
                    console.log('üìù Vehicle data for editing:', vehicle);
                    
                    document.getElementById('modalHeader').textContent = 'Edit Vehicle';
                    document.getElementById('vehicleId').value = vehicle.id;
                    document.getElementById('vehicleName').value = vehicle.name || '';
                    document.getElementById('vehicleType').value = vehicle.type || '';
                    document.getElementById('vehicleBrand').value = vehicle.brand || '';
                    document.getElementById('vehicleModel').value = vehicle.model || '';
                    document.getElementById('vehicleYear').value = vehicle.year || '';
                    document.getElementById('vehiclePrice').value = vehicle.price_per_day || '';
                    document.getElementById('vehiclePriceHour').value = vehicle.price_per_hour || '';
                    document.getElementById('vehicleCapacity').value = vehicle.capacity || 5;
                    document.getElementById('vehicleFuelType').value = vehicle.fuel_type || '';
                    document.getElementById('vehicleTransmission').value = vehicle.transmission || '';
                    document.getElementById('vehicleLocation').value = vehicle.location || '';
                    
                    // Map is_available back to status
                    const statusValue = vehicle.is_available === 1 ? 'available' : 
                                    vehicle.status === 'rented' ? 'rented' : 
                                    vehicle.status === 'maintenance' ? 'maintenance' : 'available';
                    document.getElementById('vehicleStatus').value = statusValue;
                    
                    // Parse features
                    if (vehicle.features) {
                        try {
                            const featuresArray = JSON.parse(vehicle.features);
                            document.getElementById('vehicleFeatures').value = featuresArray.join(', ');
                        } catch (e) {
                            document.getElementById('vehicleFeatures').value = vehicle.features;
                        }
                    } else {
                        document.getElementById('vehicleFeatures').value = '';
                    }
                    
                    vehicleModal.classList.add('active');
                } else {
                    throw new Error(result.message || 'Failed to load vehicle details');
                }
            } catch (error) {
                console.error('‚ùå Error loading vehicle details:', error);
                showError('Failed to load vehicle details: ' + error.message);
            }
        }

        // UI Functions
        function renderVehicles() {
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const vehiclesToShow = filteredVehicles.slice(startIndex, endIndex);
            
            if (vehiclesToShow.length === 0) {
                vehicleTableBody.innerHTML = '<tr><td colspan="6" class="no-results">No vehicles found</td></tr>';
                noResults.style.display = 'block';
                return;
            }
            
            noResults.style.display = 'none';
            
            vehicleTableBody.innerHTML = vehiclesToShow.map(vehicle => `
                <tr>
                    <td>
                        <div class="vehicle-info">
                            <div class="vehicle-icon">
                                ${getVehicleIcon(vehicle.type)}
                            </div>
                            <div>
                                <div style="font-weight: 500;">${vehicle.name}</div>
                                <div style="font-size: 13px; color: #666;">${vehicle.year}</div>
                            </div>
                        </div>
                    </td>
                    <td>${formatVehicleType(vehicle.type)}</td>
                    <td>${vehicle.brand} ${vehicle.model}</td>
                    <td>$${parseFloat(vehicle.price_per_day).toFixed(2)}</td>
                    <td>
                        <span class="status-badge ${getStatusClass(vehicle.status)}">
                            ${formatStatus(vehicle.status)}
                        </span>
                    </td>
                    <td class="actions-cell">
                        <button class="action-btn edit-action" onclick="editVehicle(${vehicle.id})" title="Edit">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                            </svg>
                        </button>
                        <button class="action-btn delete-action" onclick="confirmDelete(${vehicle.id})" title="Delete">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function renderPagination() {
            const totalPages = Math.ceil(filteredVehicles.length / itemsPerPage);
            
            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `
                <button ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </button>
            `;
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    paginationHTML += `
                        <button class="${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">
                            ${i}
                        </button>
                    `;
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    paginationHTML += `<span>...</span>`;
                }
            }
            
            // Next button
            paginationHTML += `
                <button ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </button>
            `;
            
            paginationContainer.innerHTML = paginationHTML;
        }

        function changePage(page) {
            currentPage = page;
            renderVehicles();
            renderPagination();
        }

        function handleSearch() {
            const searchTerm = searchInput.value.toLowerCase();
            
            filteredVehicles = vehicles.filter(vehicle => 
                vehicle.name.toLowerCase().includes(searchTerm) ||
                vehicle.brand.toLowerCase().includes(searchTerm) ||
                vehicle.model.toLowerCase().includes(searchTerm) ||
                vehicle.type.toLowerCase().includes(searchTerm) ||
                vehicle.location.toLowerCase().includes(searchTerm)
            );
            
            currentPage = 1;
            renderVehicles();
            renderPagination();
        }

        function toggleFilter() {
            alert('Filter functionality would be implemented here');
        }

        function openAddModal() {
            if (!authToken) {
                showLoginModal();
                return;
            }
            document.getElementById('modalHeader').textContent = 'Add Vehicle';
            document.getElementById('vehicleId').value = '';
            vehicleForm.reset();
            vehicleModal.classList.add('active');
        }

        function closeModal() {
            vehicleModal.classList.remove('active');
        }

        function confirmDelete(id) {
            if (!authToken) {
                showLoginModal();
                return;
            }
            currentVehicleId = id;
            const vehicle = vehicles.find(v => v.id === id);
            document.getElementById('confirmMessage').textContent = 
                `Are you sure you want to delete "${vehicle.name}"? This action cannot be undone.`;
            confirmModal.classList.add('active');
        }

        function closeConfirmModal() {
            confirmModal.classList.remove('active');
            currentVehicleId = null;
        }

        async function handleDelete() {
            try {
                showLoading(true);
                await deleteVehicle(currentVehicleId);
                
                // Remove from local arrays
                vehicles = vehicles.filter(v => v.id !== currentVehicleId);
                filteredVehicles = filteredVehicles.filter(v => v.id !== currentVehicleId);
                
                renderVehicles();
                renderPagination();
                closeConfirmModal();
                showSuccess('Vehicle deleted successfully');
            } catch (error) {
                console.error('‚ùå Error deleting vehicle:', error);
                showError('Failed to delete vehicle: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // Event Listeners
        // In your ManageVehicles.html, update the form submit handler:

        vehicleForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const saveBtn = document.getElementById('saveBtn');
            const saveSpinner = document.getElementById('saveSpinner');
            
            try {
                saveBtn.disabled = true;
                saveSpinner.style.display = 'inline-block';
                
                // Get form data with correct field names that match backend
                const vehicleData = {
                    name: document.getElementById('vehicleName').value,
                    type: document.getElementById('vehicleType').value,
                    brand: document.getElementById('vehicleBrand').value,
                    model: document.getElementById('vehicleModel').value,
                    year: parseInt(document.getElementById('vehicleYear').value),
                    price_per_day: parseFloat(document.getElementById('vehiclePrice').value),
                    price_per_hour: document.getElementById('vehiclePriceHour').value ? parseFloat(document.getElementById('vehiclePriceHour').value) : null,
                    capacity: parseInt(document.getElementById('vehicleCapacity').value),
                    fuel_type: document.getElementById('vehicleFuelType').value,
                    transmission: document.getElementById('vehicleTransmission').value,
                    location: document.getElementById('vehicleLocation').value,
                    status: document.getElementById('vehicleStatus').value,
                    features: document.getElementById('vehicleFeatures').value
                };
                
                console.log('üì§ Sending vehicle data:', vehicleData);
                
                // Add ID for updates
                const vehicleId = document.getElementById('vehicleId').value;
                let savedVehicle;
                
                if (vehicleId) {
                    // For updates, use the old field names to maintain compatibility
                    const updateData = {
                        vehicleName: vehicleData.name,
                        vehicleType: vehicleData.type,
                        vehicleBrand: vehicleData.brand,
                        vehicleModel: vehicleData.model,
                        vehicleYear: vehicleData.year,
                        vehiclePrice: vehicleData.price_per_day,
                        vehiclePriceHour: vehicleData.price_per_hour,
                        vehicleCapacity: vehicleData.capacity,
                        vehicleFuelType: vehicleData.fuel_type,
                        vehicleTransmission: vehicleData.transmission,
                        vehicleLocation: vehicleData.location,
                        vehicleStatus: vehicleData.status,
                        vehicleFeatures: vehicleData.features,
                        id: parseInt(vehicleId)
                    };
                    savedVehicle = await saveVehicle(updateData);
                } else {
                    // For create, use the new field names
                    savedVehicle = await saveVehicle(vehicleData);
                }
                
                // Update local arrays
                if (vehicleId) {
                    // Update existing vehicle
                    const index = vehicles.findIndex(v => v.id === parseInt(vehicleId));
                    if (index !== -1) {
                        vehicles[index] = savedVehicle;
                    }
                    
                    // Update in filtered vehicles
                    const filteredIndex = filteredVehicles.findIndex(v => v.id === parseInt(vehicleId));
                    if (filteredIndex !== -1) {
                        filteredVehicles[filteredIndex] = savedVehicle;
                    }
                } else {
                    // Add new vehicle
                    vehicles.unshift(savedVehicle);
                    filteredVehicles.unshift(savedVehicle);
                }
                
                renderVehicles();
                renderPagination();
                closeModal();
                showSuccess(`Vehicle ${vehicleId ? 'updated' : 'added'} successfully`);
            } catch (error) {
                console.error('‚ùå Error saving vehicle:', error);
                showError('Failed to save vehicle: ' + error.message);
            } finally {
                saveBtn.disabled = false;
                saveSpinner.style.display = 'none';
            }
        });

        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const loginBtn = loginForm.querySelector('.save-btn');
            const loginSpinner = document.getElementById('loginSpinner');
            
            try {
                loginBtn.disabled = true;
                loginSpinner.style.display = 'inline-block';
                
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                // Use default admin credentials
                const loginSuccess = await adminLogin(email, password);
                
                if (loginSuccess) {
                    hideLoginModal();
                    loadVehicles();
                    showSuccess('Login successful!');
                }
            } catch (error) {
                console.error('‚ùå Login error:', error);
                showError('Login failed: ' + error.message);
            } finally {
                loginBtn.disabled = false;
                loginSpinner.style.display = 'none';
            }
        });

        document.getElementById('confirmActionBtn').addEventListener('click', handleDelete);

        // Update logout button handler
        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                logout();
            }
        }

        // Utility Functions
        function getVehicleIcon(type) {
            const icons = {
                city_bike: 'üö≤',
                mountain_bike: 'üöµ',
                electric_scooter: 'üõ¥',
                compact_sedan: 'üöó',
                luxury_sedan: 'üèéÔ∏è',
                mid_size_suv: 'üöô',
                van: 'üöê',
                three_wheeler: 'üõ∫'
            };
            return icons[type] || 'üöó';
        }

        function formatVehicleType(type) {
            const types = {
                city_bike: 'City Bike',
                mountain_bike: 'Mountain Bike',
                electric_scooter: 'Electric Scooter',
                compact_sedan: 'Compact Sedan',
                luxury_sedan: 'Luxury Sedan',
                mid_size_suv: 'Mid Size SUV',
                van: 'Van',
                three_wheeler: 'Three Wheeler'
            };
            return types[type] || type;
        }

        function formatStatus(status) {
            const statusMap = {
                available: 'Available',
                rented: 'Rented',
                maintenance: 'Maintenance'
            };
            return statusMap[status] || status;
        }

        function getStatusClass(status) {
            const classMap = {
                available: 'status-available',
                rented: 'status-rented',
                maintenance: 'status-maintenance'
            };
            return classMap[status] || 'status-available';
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            successMessage.style.display = 'none';
            
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }

        function showSuccess(message) {
            successMessage.textContent = message;
            successMessage.style.display = 'block';
            errorMessage.style.display = 'none';
            
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 3000);
        }

        function showLoading(show) {
            const mainContent = document.querySelector('.main-content');
            if (show) {
                mainContent.classList.add('loading');
            } else {
                mainContent.classList.remove('loading');
            }
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>